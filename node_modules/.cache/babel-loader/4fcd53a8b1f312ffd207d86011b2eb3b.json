{"ast":null,"code":"import { safeTruncate } from '@datadog/browser-core';\nexport function getActionNameFromElement(element) {\n  // Proceed to get the action name in two steps:\n  // * first, get the name programmatically, explicitly defined by the user.\n  // * then, use strategies that are known to return good results. Those strategies will be used on\n  //   the element and a few parents, but it's likely that they won't succeed at all.\n  // * if no name is found this way, use strategies returning less accurate names as a fallback.\n  //   Those are much likely to succeed.\n  return getActionNameFromElementProgrammatically(element) || getActionNameFromElementForStrategies(element, priorityStrategies) || getActionNameFromElementForStrategies(element, fallbackStrategies) || '';\n}\n/**\n * Get the action name from the attribute 'data-dd-action-name' on the element or any of its parent.\n */\nvar PROGRAMMATIC_ATTRIBUTE = 'data-dd-action-name';\nfunction getActionNameFromElementProgrammatically(targetElement) {\n  var elementWithAttribute;\n  // We don't use getActionNameFromElementForStrategies here, because we want to consider all parents,\n  // without limit. It is up to the user to declare a relevant naming strategy.\n  // If available, use element.closest() to match get the attribute from the element or any of its\n  // parent.  Else fallback to a more traditional implementation.\n  if (supportsElementClosest()) {\n    elementWithAttribute = targetElement.closest(\"[\" + PROGRAMMATIC_ATTRIBUTE + \"]\");\n  } else {\n    var element = targetElement;\n    while (element) {\n      if (element.hasAttribute(PROGRAMMATIC_ATTRIBUTE)) {\n        elementWithAttribute = element;\n        break;\n      }\n      element = element.parentElement;\n    }\n  }\n  if (!elementWithAttribute) {\n    return;\n  }\n  var name = elementWithAttribute.getAttribute(PROGRAMMATIC_ATTRIBUTE);\n  return truncate(normalizeWhitespace(name.trim()));\n}\nvar priorityStrategies = [\n// associated LABEL text\nfunction (element) {\n  // IE does not support element.labels, so we fallback to a CSS selector based on the element id\n  // instead\n  if (supportsLabelProperty()) {\n    if ('labels' in element && element.labels && element.labels.length > 0) {\n      return getTextualContent(element.labels[0]);\n    }\n  } else if (element.id) {\n    var label = element.ownerDocument && element.ownerDocument.querySelector(\"label[for=\\\"\" + element.id.replace('\"', '\\\\\"') + \"\\\"]\");\n    return label && getTextualContent(label);\n  }\n},\n// INPUT button (and associated) value\nfunction (element) {\n  if (element.nodeName === 'INPUT') {\n    var input = element;\n    var type = input.getAttribute('type');\n    if (type === 'button' || type === 'submit' || type === 'reset') {\n      return input.value;\n    }\n  }\n},\n// BUTTON, LABEL or button-like element text\nfunction (element) {\n  if (element.nodeName === 'BUTTON' || element.nodeName === 'LABEL' || element.getAttribute('role') === 'button') {\n    return getTextualContent(element);\n  }\n}, function (element) {\n  return element.getAttribute('aria-label');\n},\n// associated element text designated by the aria-labelledby attribute\nfunction (element) {\n  var labelledByAttribute = element.getAttribute('aria-labelledby');\n  if (labelledByAttribute) {\n    return labelledByAttribute.split(/\\s+/).map(function (id) {\n      return getElementById(element, id);\n    }).filter(function (label) {\n      return Boolean(label);\n    }).map(getTextualContent).join(' ');\n  }\n}, function (element) {\n  return element.getAttribute('alt');\n}, function (element) {\n  return element.getAttribute('name');\n}, function (element) {\n  return element.getAttribute('title');\n}, function (element) {\n  return element.getAttribute('placeholder');\n},\n// SELECT first OPTION text\nfunction (element) {\n  if ('options' in element && element.options.length > 0) {\n    return getTextualContent(element.options[0]);\n  }\n}];\nvar fallbackStrategies = [function (element) {\n  return getTextualContent(element);\n}];\n/**\n * Iterates over the target element and its parent, using the strategies list to get an action name.\n * Each strategies are applied on each element, stopping as soon as a non-empty value is returned.\n */\nvar MAX_PARENTS_TO_CONSIDER = 10;\nfunction getActionNameFromElementForStrategies(targetElement, strategies) {\n  var element = targetElement;\n  var recursionCounter = 0;\n  while (recursionCounter <= MAX_PARENTS_TO_CONSIDER && element && element.nodeName !== 'BODY' && element.nodeName !== 'HTML' && element.nodeName !== 'HEAD') {\n    for (var _i = 0, strategies_1 = strategies; _i < strategies_1.length; _i++) {\n      var strategy = strategies_1[_i];\n      var name_1 = strategy(element);\n      if (typeof name_1 === 'string') {\n        var trimmedName = name_1.trim();\n        if (trimmedName) {\n          return truncate(normalizeWhitespace(trimmedName));\n        }\n      }\n    }\n    // Consider a FORM as a contextual limit to get the action name.  This is experimental and may\n    // be reconsidered in the future.\n    if (element.nodeName === 'FORM') {\n      break;\n    }\n    element = element.parentElement;\n    recursionCounter += 1;\n  }\n}\nfunction normalizeWhitespace(s) {\n  return s.replace(/\\s+/g, ' ');\n}\nfunction truncate(s) {\n  return s.length > 100 ? safeTruncate(s, 100) + \" [...]\" : s;\n}\nfunction getElementById(refElement, id) {\n  // Use the element ownerDocument here, because tests are executed in an iframe, so\n  // document.getElementById won't work.\n  return refElement.ownerDocument ? refElement.ownerDocument.getElementById(id) : null;\n}\nfunction getTextualContent(element) {\n  if (element.isContentEditable) {\n    return;\n  }\n  if ('innerText' in element) {\n    var text = element.innerText;\n    if (!supportsInnerTextScriptAndStyleRemoval()) {\n      // remove the inner text of SCRIPT and STYLES from the result. This is a bit dirty, but should\n      // be relatively fast and work in most cases.\n      var elementsTextToRemove = element.querySelectorAll('script, style');\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (var i = 0; i < elementsTextToRemove.length; i += 1) {\n        var innerText = elementsTextToRemove[i].innerText;\n        if (innerText.trim().length > 0) {\n          text = text.replace(innerText, '');\n        }\n      }\n    }\n    return text;\n  }\n  return element.textContent;\n}\n/**\n * Returns true if element.innerText excludes the text from inline SCRIPT and STYLE element.  This\n * should be the case everywhere except on some version of Internet Explorer.\n * See http://perfectionkills.com/the-poor-misunderstood-innerText/#diff-with-textContent\n */\nvar supportsInnerTextScriptAndStyleRemovalResult;\nfunction supportsInnerTextScriptAndStyleRemoval() {\n  if (supportsInnerTextScriptAndStyleRemovalResult === undefined) {\n    var style = document.createElement('style');\n    style.textContent = '*';\n    var div = document.createElement('div');\n    div.appendChild(style);\n    document.body.appendChild(div);\n    supportsInnerTextScriptAndStyleRemovalResult = div.innerText === '';\n    document.body.removeChild(div);\n  }\n  return supportsInnerTextScriptAndStyleRemovalResult;\n}\n/**\n * Returns true if the browser supports the element.labels property.  This should be the case\n * everywhere except on Internet Explorer.\n * Note: The result is computed lazily, because we don't want any DOM access when the SDK is\n * evaluated.\n */\nvar supportsLabelPropertyResult;\nfunction supportsLabelProperty() {\n  if (supportsLabelPropertyResult === undefined) {\n    supportsLabelPropertyResult = 'labels' in HTMLInputElement.prototype;\n  }\n  return supportsLabelPropertyResult;\n}\n/**\n * Returns true if the browser supports the element.closest method.  This should be the case\n * everywhere except on Internet Explorer.\n * Note: The result is computed lazily, because we don't want any DOM access when the SDK is\n * evaluated.\n */\nvar supportsElementClosestResult;\nfunction supportsElementClosest() {\n  if (supportsElementClosestResult === undefined) {\n    supportsElementClosestResult = 'closest' in HTMLElement.prototype;\n  }\n  return supportsElementClosestResult;\n}","map":{"version":3,"names":["safeTruncate","getActionNameFromElement","element","getActionNameFromElementProgrammatically","getActionNameFromElementForStrategies","priorityStrategies","fallbackStrategies","PROGRAMMATIC_ATTRIBUTE","targetElement","elementWithAttribute","supportsElementClosest","closest","hasAttribute","parentElement","name","getAttribute","truncate","normalizeWhitespace","trim","supportsLabelProperty","labels","length","getTextualContent","id","label","ownerDocument","querySelector","replace","nodeName","input","type","value","labelledByAttribute","split","map","getElementById","filter","Boolean","join","options","MAX_PARENTS_TO_CONSIDER","strategies","recursionCounter","_i","strategies_1","strategy","name_1","trimmedName","s","refElement","isContentEditable","text","innerText","supportsInnerTextScriptAndStyleRemoval","elementsTextToRemove","querySelectorAll","i","textContent","supportsInnerTextScriptAndStyleRemovalResult","undefined","style","document","createElement","div","appendChild","body","removeChild","supportsLabelPropertyResult","HTMLInputElement","prototype","supportsElementClosestResult","HTMLElement"],"sources":["../../../../src/domain/rumEventsCollection/action/getActionNameFromElement.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}