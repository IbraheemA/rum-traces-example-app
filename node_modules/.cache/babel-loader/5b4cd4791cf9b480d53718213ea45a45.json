{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { computeStackTrace, formatUnknownError, startAutomaticErrorCollection, generateUUID, ErrorHandling } from '@datadog/browser-core';\nimport { RumEventType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nexport function startErrorCollection(lifeCycle, configuration, foregroundContexts) {\n  startAutomaticErrorCollection(configuration).subscribe(function (error) {\n    return lifeCycle.notify(LifeCycleEventType.RAW_ERROR_COLLECTED, {\n      error: error\n    });\n  });\n  return doStartErrorCollection(lifeCycle, foregroundContexts);\n}\nexport function doStartErrorCollection(lifeCycle, foregroundContexts) {\n  lifeCycle.subscribe(LifeCycleEventType.RAW_ERROR_COLLECTED, function (_a) {\n    var error = _a.error,\n      customerContext = _a.customerContext,\n      savedCommonContext = _a.savedCommonContext;\n    lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, __assign({\n      customerContext: customerContext,\n      savedCommonContext: savedCommonContext\n    }, processError(error, foregroundContexts)));\n  });\n  return {\n    addError: function (_a, savedCommonContext) {\n      var error = _a.error,\n        startClocks = _a.startClocks,\n        customerContext = _a.context,\n        source = _a.source;\n      var rawError = computeRawError(error, startClocks, source);\n      lifeCycle.notify(LifeCycleEventType.RAW_ERROR_COLLECTED, {\n        customerContext: customerContext,\n        savedCommonContext: savedCommonContext,\n        error: rawError\n      });\n    }\n  };\n}\nfunction computeRawError(error, startClocks, source) {\n  var stackTrace = error instanceof Error ? computeStackTrace(error) : undefined;\n  return __assign(__assign({\n    startClocks: startClocks,\n    source: source,\n    originalError: error\n  }, formatUnknownError(stackTrace, error, 'Provided')), {\n    handling: ErrorHandling.HANDLED\n  });\n}\nfunction processError(error, foregroundContexts) {\n  var rawRumEvent = {\n    date: error.startClocks.timeStamp,\n    error: {\n      id: generateUUID(),\n      message: error.message,\n      resource: error.resource ? {\n        method: error.resource.method,\n        status_code: error.resource.statusCode,\n        url: error.resource.url\n      } : undefined,\n      source: error.source,\n      stack: error.stack,\n      type: error.type,\n      handling: error.handling\n    },\n    type: RumEventType.ERROR\n  };\n  var inForeground = foregroundContexts.getInForeground(error.startClocks.relative);\n  if (inForeground !== undefined) {\n    rawRumEvent.view = {\n      in_foreground: inForeground\n    };\n  }\n  return {\n    rawRumEvent: rawRumEvent,\n    startTime: error.startClocks.relative,\n    domainContext: {\n      error: error.originalError\n    }\n  };\n}","map":{"version":3,"names":["computeStackTrace","formatUnknownError","startAutomaticErrorCollection","generateUUID","ErrorHandling","RumEventType","LifeCycleEventType","startErrorCollection","lifeCycle","configuration","foregroundContexts","subscribe","error","notify","RAW_ERROR_COLLECTED","doStartErrorCollection","_a","customerContext","savedCommonContext","RAW_RUM_EVENT_COLLECTED","__assign","processError","addError","startClocks","context","source","rawError","computeRawError","stackTrace","Error","undefined","originalError","handling","HANDLED","rawRumEvent","date","timeStamp","id","message","resource","method","status_code","statusCode","url","stack","type","ERROR","inForeground","getInForeground","relative","view","in_foreground","startTime","domainContext"],"sources":["../../../../src/domain/rumEventsCollection/error/errorCollection.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}