{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { combine, toServerDuration, generateUUID } from '@datadog/browser-core';\nimport { ActionType, RumEventType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackActions } from './trackActions';\nexport function startActionCollection(lifeCycle, domMutationObservable, configuration, foregroundContexts) {\n  lifeCycle.subscribe(LifeCycleEventType.AUTO_ACTION_COMPLETED, function (action) {\n    return lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processAction(action, foregroundContexts));\n  });\n  if (configuration.trackInteractions) {\n    trackActions(lifeCycle, domMutationObservable);\n  }\n  return {\n    addAction: function (action, savedCommonContext) {\n      lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, __assign({\n        savedCommonContext: savedCommonContext\n      }, processAction(action, foregroundContexts)));\n    }\n  };\n}\nfunction processAction(action, foregroundContexts) {\n  var autoActionProperties = isAutoAction(action) ? {\n    action: {\n      error: {\n        count: action.counts.errorCount\n      },\n      id: action.id,\n      loading_time: toServerDuration(action.duration),\n      long_task: {\n        count: action.counts.longTaskCount\n      },\n      resource: {\n        count: action.counts.resourceCount\n      }\n    }\n  } : undefined;\n  var customerContext = !isAutoAction(action) ? action.context : undefined;\n  var actionEvent = combine({\n    action: {\n      id: generateUUID(),\n      target: {\n        name: action.name\n      },\n      type: action.type\n    },\n    date: action.startClocks.timeStamp,\n    type: RumEventType.ACTION\n  }, autoActionProperties);\n  var inForeground = foregroundContexts.getInForeground(action.startClocks.relative);\n  if (inForeground !== undefined) {\n    actionEvent.view = {\n      in_foreground: inForeground\n    };\n  }\n  return {\n    customerContext: customerContext,\n    rawRumEvent: actionEvent,\n    startTime: action.startClocks.relative,\n    domainContext: isAutoAction(action) ? {\n      event: action.event\n    } : {}\n  };\n}\nfunction isAutoAction(action) {\n  return action.type !== ActionType.CUSTOM;\n}","map":{"version":3,"names":["combine","toServerDuration","generateUUID","ActionType","RumEventType","LifeCycleEventType","trackActions","startActionCollection","lifeCycle","domMutationObservable","configuration","foregroundContexts","subscribe","AUTO_ACTION_COMPLETED","action","notify","RAW_RUM_EVENT_COLLECTED","processAction","trackInteractions","addAction","savedCommonContext","__assign","autoActionProperties","isAutoAction","error","count","counts","errorCount","id","loading_time","duration","long_task","longTaskCount","resource","resourceCount","undefined","customerContext","context","actionEvent","target","name","type","date","startClocks","timeStamp","ACTION","inForeground","getInForeground","relative","view","in_foreground","rawRumEvent","startTime","domainContext","event","CUSTOM"],"sources":["../../../../src/domain/rumEventsCollection/action/actionCollection.ts"],"sourcesContent":[null],"mappings":";AAAA,SAASA,OAAO,EAAiBC,gBAAgB,EAAEC,YAAY,QAAQ,uBAAuB;AAC9F,SAASC,UAAU,EAAiBC,YAAY,QAA2B,4BAA4B;AACvG,SAAoBC,kBAAkB,QAAkC,iBAAiB;AAGzF,SAAmCC,YAAY,QAAQ,gBAAgB;AAEvE,OAAM,SAAUC,qBAAqBA,CACnCC,SAAoB,EACpBC,qBAA4C,EAC5CC,aAA4B,EAC5BC,kBAAsC;EAEtCH,SAAS,CAACI,SAAS,CAACP,kBAAkB,CAACQ,qBAAqB,EAAE,UAACC,MAAM;IACnE,OAAAN,SAAS,CAACO,MAAM,CAACV,kBAAkB,CAACW,uBAAuB,EAAEC,aAAa,CAACH,MAAM,EAAEH,kBAAkB,CAAC,CAAC;EAAvG,CAAuG,CACxG;EAED,IAAID,aAAa,CAACQ,iBAAiB,EAAE;IACnCZ,YAAY,CAACE,SAAS,EAAEC,qBAAqB,CAAC;;EAGhD,OAAO;IACLU,SAAS,EAAE,SAAAA,CAACL,MAAoB,EAAEM,kBAAkC;MAClEZ,SAAS,CAACO,MAAM,CAACV,kBAAkB,CAACW,uBAAuB,EAAAK,QAAA;QACzDD,kBAAkB,EAAAA;MAAA,GACfH,aAAa,CAACH,MAAM,EAAEH,kBAAkB,CAAC,EAC5C;IACJ;GACD;AACH;AAEA,SAASM,aAAaA,CACpBH,MAAiC,EACjCH,kBAAsC;EAEtC,IAAMW,oBAAoB,GAAGC,YAAY,CAACT,MAAM,CAAC,GAC7C;IACEA,MAAM,EAAE;MACNU,KAAK,EAAE;QACLC,KAAK,EAAEX,MAAM,CAACY,MAAM,CAACC;OACtB;MACDC,EAAE,EAAEd,MAAM,CAACc,EAAE;MACbC,YAAY,EAAE5B,gBAAgB,CAACa,MAAM,CAACgB,QAAQ,CAAC;MAC/CC,SAAS,EAAE;QACTN,KAAK,EAAEX,MAAM,CAACY,MAAM,CAACM;OACtB;MACDC,QAAQ,EAAE;QACRR,KAAK,EAAEX,MAAM,CAACY,MAAM,CAACQ;;;GAG1B,GACDC,SAAS;EACb,IAAMC,eAAe,GAAG,CAACb,YAAY,CAACT,MAAM,CAAC,GAAGA,MAAM,CAACuB,OAAO,GAAGF,SAAS;EAC1E,IAAMG,WAAW,GAAsBtC,OAAO,CAC5C;IACEc,MAAM,EAAE;MACNc,EAAE,EAAE1B,YAAY,EAAE;MAClBqC,MAAM,EAAE;QACNC,IAAI,EAAE1B,MAAM,CAAC0B;OACd;MACDC,IAAI,EAAE3B,MAAM,CAAC2B;KACd;IACDC,IAAI,EAAE5B,MAAM,CAAC6B,WAAW,CAACC,SAAS;IAClCH,IAAI,EAAErC,YAAY,CAACyC;GACpB,EACDvB,oBAAoB,CACrB;EACD,IAAMwB,YAAY,GAAGnC,kBAAkB,CAACoC,eAAe,CAACjC,MAAM,CAAC6B,WAAW,CAACK,QAAQ,CAAC;EACpF,IAAIF,YAAY,KAAKX,SAAS,EAAE;IAC9BG,WAAW,CAACW,IAAI,GAAG;MAAEC,aAAa,EAAEJ;IAAY,CAAE;;EAEpD,OAAO;IACLV,eAAe,EAAAA,eAAA;IACfe,WAAW,EAAEb,WAAW;IACxBc,SAAS,EAAEtC,MAAM,CAAC6B,WAAW,CAACK,QAAQ;IACtCK,aAAa,EAAE9B,YAAY,CAACT,MAAM,CAAC,GAAG;MAAEwC,KAAK,EAAExC,MAAM,CAACwC;IAAK,CAAE,GAAG;GACjE;AACH;AAEA,SAAS/B,YAAYA,CAACT,MAAiC;EACrD,OAAOA,MAAM,CAAC2B,IAAI,KAAKtC,UAAU,CAACoD,MAAM;AAC1C","ignoreList":[]},"metadata":{},"sourceType":"module"}