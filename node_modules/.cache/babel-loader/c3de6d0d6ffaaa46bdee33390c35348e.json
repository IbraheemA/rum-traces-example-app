{"ast":null,"code":"var isContextArray = function (value) {\n  return Array.isArray(value);\n};\nvar isContext = function (value) {\n  return !Array.isArray(value) && typeof value === 'object' && value !== null;\n};\nexport function combine() {\n  var sources = [];\n  for (var _i = 0; _i < arguments.length; _i++) {\n    sources[_i] = arguments[_i];\n  }\n  var destination;\n  for (var _a = 0, sources_1 = sources; _a < sources_1.length; _a++) {\n    var source = sources_1[_a];\n    // Ignore any undefined or null sources.\n    if (source === undefined || source === null) {\n      continue;\n    }\n    destination = mergeInto(destination, source, createCircularReferenceChecker());\n  }\n  return destination;\n}\n/*\n * Performs a deep clone of objects and arrays.\n * - Circular references are replaced by 'undefined'\n */\nexport function deepClone(context) {\n  return mergeInto(undefined, context, createCircularReferenceChecker());\n}\nexport function createCircularReferenceChecker() {\n  if (typeof WeakSet !== 'undefined') {\n    var set_1 = new WeakSet();\n    return {\n      hasAlreadyBeenSeen: function (value) {\n        var has = set_1.has(value);\n        if (!has) {\n          set_1.add(value);\n        }\n        return has;\n      }\n    };\n  }\n  var array = [];\n  return {\n    hasAlreadyBeenSeen: function (value) {\n      var has = array.indexOf(value) >= 0;\n      if (!has) {\n        array.push(value);\n      }\n      return has;\n    }\n  };\n}\n/**\n * Iterate over 'source' and affect its subvalues into 'destination', recursively.  If the 'source'\n * and 'destination' can't be merged, return 'source'.\n */\nexport function mergeInto(destination, source, circularReferenceChecker) {\n  // Ignore the 'source' if it is undefined\n  if (source === undefined) {\n    return destination;\n  }\n  // If the 'source' is not an object or array, it can't be merged with 'destination' in any way, so\n  // return it directly.\n  if (!isContext(source) && !isContextArray(source)) {\n    return source;\n  }\n  // Return 'undefined' if we already iterated over this 'source' to avoid infinite recursion\n  if (circularReferenceChecker.hasAlreadyBeenSeen(source)) {\n    return undefined;\n  }\n  // 'source' and 'destination' are objects, merge them together\n  if (isContext(source) && (destination === undefined || isContext(destination))) {\n    var finalDestination = destination || {};\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        finalDestination[key] = mergeInto(finalDestination[key], source[key], circularReferenceChecker);\n      }\n    }\n    return finalDestination;\n  }\n  // 'source' and 'destination' are arrays, merge them together\n  if (isContextArray(source) && (destination === undefined || isContextArray(destination))) {\n    var finalDestination = destination || [];\n    finalDestination.length = Math.max(finalDestination.length, source.length);\n    for (var index = 0; index < source.length; index += 1) {\n      finalDestination[index] = mergeInto(finalDestination[index], source[index], circularReferenceChecker);\n    }\n    return finalDestination;\n  }\n  // The destination in not an array nor an object, so we can't merge it\n  return source;\n}","map":{"version":3,"names":["isContextArray","value","Array","isArray","isContext","combine","sources","_i","arguments","length","destination","_a","sources_1","source","undefined","mergeInto","createCircularReferenceChecker","deepClone","context","WeakSet","set_1","hasAlreadyBeenSeen","has","add","array","indexOf","push","circularReferenceChecker","finalDestination","key","Object","prototype","hasOwnProperty","call","Math","max","index"],"sources":["../../src/tools/context.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}