{"ast":null,"code":"import { performDraw, startSessionManagement } from '@datadog/browser-core';\nimport { LifeCycleEventType } from './lifeCycle';\nexport var RUM_SESSION_KEY = 'rum';\nexport var RumTrackingType;\n(function (RumTrackingType) {\n  RumTrackingType[\"NOT_TRACKED\"] = \"0\";\n  RumTrackingType[\"TRACKED_WITH_RESOURCES\"] = \"1\";\n  RumTrackingType[\"TRACKED_WITHOUT_RESOURCES\"] = \"2\";\n})(RumTrackingType || (RumTrackingType = {}));\nexport function startRumSession(configuration, lifeCycle) {\n  var session = startSessionManagement(configuration.cookieOptions, RUM_SESSION_KEY, function (rawTrackingType) {\n    return computeSessionState(configuration, rawTrackingType);\n  });\n  session.renewObservable.subscribe(function () {\n    lifeCycle.notify(LifeCycleEventType.SESSION_RENEWED);\n  });\n  return {\n    getId: session.getId,\n    isTracked: function () {\n      return session.getId() !== undefined && isTracked(session.getTrackingType());\n    },\n    isTrackedWithResource: function () {\n      return session.getId() !== undefined && session.getTrackingType() === RumTrackingType.TRACKED_WITH_RESOURCES;\n    }\n  };\n}\nfunction computeSessionState(configuration, rawTrackingType) {\n  var trackingType;\n  if (hasValidRumSession(rawTrackingType)) {\n    trackingType = rawTrackingType;\n  } else if (!performDraw(configuration.sampleRate)) {\n    trackingType = RumTrackingType.NOT_TRACKED;\n  } else if (!performDraw(configuration.resourceSampleRate)) {\n    trackingType = RumTrackingType.TRACKED_WITHOUT_RESOURCES;\n  } else {\n    trackingType = RumTrackingType.TRACKED_WITH_RESOURCES;\n  }\n  return {\n    trackingType: trackingType,\n    isTracked: isTracked(trackingType)\n  };\n}\nfunction hasValidRumSession(trackingType) {\n  return trackingType === RumTrackingType.NOT_TRACKED || trackingType === RumTrackingType.TRACKED_WITH_RESOURCES || trackingType === RumTrackingType.TRACKED_WITHOUT_RESOURCES;\n}\nfunction isTracked(rumSessionType) {\n  return rumSessionType === RumTrackingType.TRACKED_WITH_RESOURCES || rumSessionType === RumTrackingType.TRACKED_WITHOUT_RESOURCES;\n}","map":{"version":3,"names":["performDraw","startSessionManagement","LifeCycleEventType","RUM_SESSION_KEY","RumTrackingType","startRumSession","configuration","lifeCycle","session","cookieOptions","rawTrackingType","computeSessionState","renewObservable","subscribe","notify","SESSION_RENEWED","getId","isTracked","undefined","getTrackingType","isTrackedWithResource","TRACKED_WITH_RESOURCES","trackingType","hasValidRumSession","sampleRate","NOT_TRACKED","resourceSampleRate","TRACKED_WITHOUT_RESOURCES","rumSessionType"],"sources":["../../src/domain/rumSession.ts"],"sourcesContent":[null],"mappings":"AAAA,SAAwBA,WAAW,EAAEC,sBAAsB,QAAQ,uBAAuB;AAC1F,SAAoBC,kBAAkB,QAAQ,aAAa;AAE3D,OAAO,IAAMC,eAAe,GAAG,KAAK;AAQpC,WAAYC,eAIX;AAJD,WAAYA,eAAe;EACzBA,eAAA,qBAAiB;EACjBA,eAAA,gCAA4B;EAC5BA,eAAA,mCAA+B;AACjC,CAAC,EAJWA,eAAe,KAAfA,eAAe;AAM3B,OAAM,SAAUC,eAAeA,CAACC,aAA4B,EAAEC,SAAoB;EAChF,IAAMC,OAAO,GAAGP,sBAAsB,CAACK,aAAa,CAACG,aAAa,EAAEN,eAAe,EAAE,UAACO,eAAe;IACnG,OAAAC,mBAAmB,CAACL,aAAa,EAAEI,eAAe,CAAC;EAAnD,CAAmD,CACpD;EAEDF,OAAO,CAACI,eAAe,CAACC,SAAS,CAAC;IAChCN,SAAS,CAACO,MAAM,CAACZ,kBAAkB,CAACa,eAAe,CAAC;EACtD,CAAC,CAAC;EAEF,OAAO;IACLC,KAAK,EAAER,OAAO,CAACQ,KAAK;IACpBC,SAAS,EAAE,SAAAA,CAAA;MAAM,OAAAT,OAAO,CAACQ,KAAK,EAAE,KAAKE,SAAS,IAAID,SAAS,CAACT,OAAO,CAACW,eAAe,EAAE,CAAC;IAArE,CAAqE;IACtFC,qBAAqB,EAAE,SAAAA,CAAA;MACrB,OAAAZ,OAAO,CAACQ,KAAK,EAAE,KAAKE,SAAS,IAAIV,OAAO,CAACW,eAAe,EAAE,KAAKf,eAAe,CAACiB,sBAAsB;IAArG;GACH;AACH;AAEA,SAASV,mBAAmBA,CAACL,aAA4B,EAAEI,eAAwB;EACjF,IAAIY,YAA6B;EACjC,IAAIC,kBAAkB,CAACb,eAAe,CAAC,EAAE;IACvCY,YAAY,GAAGZ,eAAe;GAC/B,MAAM,IAAI,CAACV,WAAW,CAACM,aAAa,CAACkB,UAAU,CAAC,EAAE;IACjDF,YAAY,GAAGlB,eAAe,CAACqB,WAAW;GAC3C,MAAM,IAAI,CAACzB,WAAW,CAACM,aAAa,CAACoB,kBAAkB,CAAC,EAAE;IACzDJ,YAAY,GAAGlB,eAAe,CAACuB,yBAAyB;GACzD,MAAM;IACLL,YAAY,GAAGlB,eAAe,CAACiB,sBAAsB;;EAEvD,OAAO;IACLC,YAAY,EAAAA,YAAA;IACZL,SAAS,EAAEA,SAAS,CAACK,YAAY;GAClC;AACH;AAEA,SAASC,kBAAkBA,CAACD,YAAqB;EAC/C,OACEA,YAAY,KAAKlB,eAAe,CAACqB,WAAW,IAC5CH,YAAY,KAAKlB,eAAe,CAACiB,sBAAsB,IACvDC,YAAY,KAAKlB,eAAe,CAACuB,yBAAyB;AAE9D;AAEA,SAASV,SAASA,CAACW,cAA2C;EAC5D,OACEA,cAAc,KAAKxB,eAAe,CAACiB,sBAAsB,IACzDO,cAAc,KAAKxB,eAAe,CAACuB,yBAAyB;AAEhE","ignoreList":[]},"metadata":{},"sourceType":"module"}