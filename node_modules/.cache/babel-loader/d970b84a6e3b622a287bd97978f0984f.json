{"ast":null,"code":"import { addEventListener, elapsed, generateUUID, clocksNow } from '@datadog/browser-core';\nimport { ActionType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackEventCounts } from '../../trackEventCounts';\nimport { waitIdlePageActivity } from '../../trackPageActivities';\nimport { getActionNameFromElement } from './getActionNameFromElement';\nexport function trackActions(lifeCycle, domMutationObservable) {\n  var action = startActionManagement(lifeCycle, domMutationObservable);\n  // New views trigger the discard of the current pending Action\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_CREATED, function () {\n    action.discardCurrent();\n  });\n  var stopListener = addEventListener(window, \"click\" /* CLICK */, function (event) {\n    if (!(event.target instanceof Element)) {\n      return;\n    }\n    var name = getActionNameFromElement(event.target);\n    if (!name) {\n      return;\n    }\n    action.create(ActionType.CLICK, name, event);\n  }, {\n    capture: true\n  }).stop;\n  return {\n    stop: function () {\n      action.discardCurrent();\n      stopListener();\n    }\n  };\n}\nfunction startActionManagement(lifeCycle, domMutationObservable) {\n  var currentAction;\n  var currentIdlePageActivitySubscription;\n  return {\n    create: function (type, name, event) {\n      if (currentAction) {\n        // Ignore any new action if another one is already occurring.\n        return;\n      }\n      var pendingAutoAction = new PendingAutoAction(lifeCycle, type, name, event);\n      currentAction = pendingAutoAction;\n      currentIdlePageActivitySubscription = waitIdlePageActivity(lifeCycle, domMutationObservable, function (params) {\n        if (params.hadActivity) {\n          pendingAutoAction.complete(params.endTime);\n        } else {\n          pendingAutoAction.discard();\n        }\n        currentAction = undefined;\n      });\n    },\n    discardCurrent: function () {\n      if (currentAction) {\n        currentIdlePageActivitySubscription.stop();\n        currentAction.discard();\n        currentAction = undefined;\n      }\n    }\n  };\n}\nvar PendingAutoAction = /** @class */function () {\n  function PendingAutoAction(lifeCycle, type, name, event) {\n    this.lifeCycle = lifeCycle;\n    this.type = type;\n    this.name = name;\n    this.event = event;\n    this.id = generateUUID();\n    this.startClocks = clocksNow();\n    this.eventCountsSubscription = trackEventCounts(lifeCycle);\n    this.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_CREATED, {\n      id: this.id,\n      startClocks: this.startClocks\n    });\n  }\n  PendingAutoAction.prototype.complete = function (endTime) {\n    var eventCounts = this.eventCountsSubscription.eventCounts;\n    this.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_COMPLETED, {\n      counts: {\n        errorCount: eventCounts.errorCount,\n        longTaskCount: eventCounts.longTaskCount,\n        resourceCount: eventCounts.resourceCount\n      },\n      duration: elapsed(this.startClocks.timeStamp, endTime),\n      id: this.id,\n      name: this.name,\n      startClocks: this.startClocks,\n      type: this.type,\n      event: this.event\n    });\n    this.eventCountsSubscription.stop();\n  };\n  PendingAutoAction.prototype.discard = function () {\n    this.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_DISCARDED);\n    this.eventCountsSubscription.stop();\n  };\n  return PendingAutoAction;\n}();","map":{"version":3,"names":["addEventListener","elapsed","generateUUID","clocksNow","ActionType","LifeCycleEventType","trackEventCounts","waitIdlePageActivity","getActionNameFromElement","trackActions","lifeCycle","domMutationObservable","action","startActionManagement","subscribe","VIEW_CREATED","discardCurrent","stopListener","window","event","target","Element","name","create","CLICK","capture","stop","currentAction","currentIdlePageActivitySubscription","type","pendingAutoAction","PendingAutoAction","params","hadActivity","complete","endTime","discard","undefined","id","startClocks","eventCountsSubscription","notify","AUTO_ACTION_CREATED","prototype","eventCounts","AUTO_ACTION_COMPLETED","counts","errorCount","longTaskCount","resourceCount","duration","timeStamp","AUTO_ACTION_DISCARDED"],"sources":["../../../../src/domain/rumEventsCollection/action/trackActions.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}