{"ast":null,"code":"import { getCookie } from '../browser/cookie';\nimport { persistSession } from './sessionManagement';\nexport var OLD_SESSION_COOKIE_NAME = '_dd';\nexport var OLD_RUM_COOKIE_NAME = '_dd_r';\nexport var OLD_LOGS_COOKIE_NAME = '_dd_l';\n// duplicate values to avoid dependency issues\nexport var RUM_SESSION_KEY = 'rum';\nexport var LOGS_SESSION_KEY = 'logs';\n/**\n * This migration should remain in the codebase as long as older versions are available/live\n * to allow older sdk versions to be upgraded to newer versions without compatibility issues.\n */\nexport function tryOldCookiesMigration(sessionCookie) {\n  var sessionString = sessionCookie.get();\n  var oldSessionId = getCookie(OLD_SESSION_COOKIE_NAME);\n  var oldRumType = getCookie(OLD_RUM_COOKIE_NAME);\n  var oldLogsType = getCookie(OLD_LOGS_COOKIE_NAME);\n  if (!sessionString) {\n    var session = {};\n    if (oldSessionId) {\n      session.id = oldSessionId;\n    }\n    if (oldLogsType && /^[01]$/.test(oldLogsType)) {\n      session[LOGS_SESSION_KEY] = oldLogsType;\n    }\n    if (oldRumType && /^[012]$/.test(oldRumType)) {\n      session[RUM_SESSION_KEY] = oldRumType;\n    }\n    persistSession(session, sessionCookie);\n  }\n}","map":{"version":3,"names":["getCookie","persistSession","OLD_SESSION_COOKIE_NAME","OLD_RUM_COOKIE_NAME","OLD_LOGS_COOKIE_NAME","RUM_SESSION_KEY","LOGS_SESSION_KEY","tryOldCookiesMigration","sessionCookie","sessionString","get","oldSessionId","oldRumType","oldLogsType","session","id","test"],"sources":["../../src/domain/oldCookiesMigration.ts"],"sourcesContent":[null],"mappings":"AAAA,SAAsBA,SAAS,QAAQ,mBAAmB;AAC1D,SAASC,cAAc,QAAsB,qBAAqB;AAElE,OAAO,IAAMC,uBAAuB,GAAG,KAAK;AAC5C,OAAO,IAAMC,mBAAmB,GAAG,OAAO;AAC1C,OAAO,IAAMC,oBAAoB,GAAG,OAAO;AAE3C;AACA,OAAO,IAAMC,eAAe,GAAG,KAAK;AACpC,OAAO,IAAMC,gBAAgB,GAAG,MAAM;AAEtC;;;;AAIA,OAAM,SAAUC,sBAAsBA,CAACC,aAA0B;EAC/D,IAAMC,aAAa,GAAGD,aAAa,CAACE,GAAG,EAAE;EACzC,IAAMC,YAAY,GAAGX,SAAS,CAACE,uBAAuB,CAAC;EACvD,IAAMU,UAAU,GAAGZ,SAAS,CAACG,mBAAmB,CAAC;EACjD,IAAMU,WAAW,GAAGb,SAAS,CAACI,oBAAoB,CAAC;EACnD,IAAI,CAACK,aAAa,EAAE;IAClB,IAAMK,OAAO,GAAiB,EAAE;IAChC,IAAIH,YAAY,EAAE;MAChBG,OAAO,CAACC,EAAE,GAAGJ,YAAY;;IAE3B,IAAIE,WAAW,IAAI,QAAQ,CAACG,IAAI,CAACH,WAAW,CAAC,EAAE;MAC7CC,OAAO,CAACR,gBAAgB,CAAC,GAAGO,WAAW;;IAEzC,IAAID,UAAU,IAAI,SAAS,CAACI,IAAI,CAACJ,UAAU,CAAC,EAAE;MAC5CE,OAAO,CAACT,eAAe,CAAC,GAAGO,UAAU;;IAEvCX,cAAc,CAACa,OAAO,EAAEN,aAAa,CAAC;;AAE1C","ignoreList":[]},"metadata":{},"sourceType":"module"}