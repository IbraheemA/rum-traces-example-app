{"ast":null,"code":"import { combine } from '@datadog/browser-core';\nimport { createDOMMutationObservable } from '../browser/domMutationObservable';\nimport { startPerformanceCollection } from '../browser/performanceCollection';\nimport { startRumAssembly } from '../domain/assembly';\nimport { startForegroundContexts } from '../domain/foregroundContexts';\nimport { startInternalContext } from '../domain/internalContext';\nimport { LifeCycle } from '../domain/lifeCycle';\nimport { startParentContexts } from '../domain/parentContexts';\nimport { startRequestCollection } from '../domain/requestCollection';\nimport { startActionCollection } from '../domain/rumEventsCollection/action/actionCollection';\nimport { startErrorCollection } from '../domain/rumEventsCollection/error/errorCollection';\nimport { startLongTaskCollection } from '../domain/rumEventsCollection/longTask/longTaskCollection';\nimport { startResourceCollection } from '../domain/rumEventsCollection/resource/resourceCollection';\nimport { startViewCollection } from '../domain/rumEventsCollection/view/viewCollection';\nimport { startRumSession } from '../domain/rumSession';\nimport { startRumBatch } from '../transport/batch';\nexport function startRum(userConfiguration, configuration, internalMonitoring, getCommonContext, initialViewName) {\n  var lifeCycle = new LifeCycle();\n  var session = startRumSession(configuration, lifeCycle);\n  var domMutationObservable = createDOMMutationObservable();\n  internalMonitoring.setExternalContextProvider(function () {\n    return combine({\n      application_id: userConfiguration.applicationId\n    }, parentContexts.findView(), getCommonContext().context);\n  });\n  var _a = startRumEventCollection(userConfiguration.applicationId, lifeCycle, configuration, session, getCommonContext),\n    parentContexts = _a.parentContexts,\n    foregroundContexts = _a.foregroundContexts;\n  startLongTaskCollection(lifeCycle);\n  startResourceCollection(lifeCycle, session);\n  var _b = startViewCollection(lifeCycle, configuration, location, domMutationObservable, foregroundContexts, initialViewName),\n    addTiming = _b.addTiming,\n    startView = _b.startView;\n  var addError = startErrorCollection(lifeCycle, configuration, foregroundContexts).addError;\n  var addAction = startActionCollection(lifeCycle, domMutationObservable, configuration, foregroundContexts).addAction;\n  startRequestCollection(lifeCycle, configuration);\n  startPerformanceCollection(lifeCycle, configuration);\n  var internalContext = startInternalContext(userConfiguration.applicationId, session, parentContexts);\n  return {\n    addAction: addAction,\n    addError: addError,\n    addTiming: addTiming,\n    startView: startView,\n    lifeCycle: lifeCycle,\n    parentContexts: parentContexts,\n    session: session,\n    getInternalContext: internalContext.get\n  };\n}\nexport function startRumEventCollection(applicationId, lifeCycle, configuration, session, getCommonContext) {\n  var parentContexts = startParentContexts(lifeCycle, session);\n  var foregroundContexts = startForegroundContexts(configuration);\n  var batch = startRumBatch(configuration, lifeCycle);\n  startRumAssembly(applicationId, configuration, lifeCycle, session, parentContexts, getCommonContext);\n  return {\n    parentContexts: parentContexts,\n    foregroundContexts: foregroundContexts,\n    stop: function () {\n      // prevent batch from previous tests to keep running and send unwanted requests\n      // could be replaced by stopping all the component when they will all have a stop method\n      batch.stop();\n      parentContexts.stop();\n      foregroundContexts.stop();\n    }\n  };\n}","map":{"version":3,"names":["combine","createDOMMutationObservable","startPerformanceCollection","startRumAssembly","startForegroundContexts","startInternalContext","LifeCycle","startParentContexts","startRequestCollection","startActionCollection","startErrorCollection","startLongTaskCollection","startResourceCollection","startViewCollection","startRumSession","startRumBatch","startRum","userConfiguration","configuration","internalMonitoring","getCommonContext","initialViewName","lifeCycle","session","domMutationObservable","setExternalContextProvider","application_id","applicationId","parentContexts","findView","context","_a","startRumEventCollection","foregroundContexts","_b","location","addTiming","startView","addError","addAction","internalContext","getInternalContext","get","batch","stop"],"sources":["../../src/boot/startRum.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}