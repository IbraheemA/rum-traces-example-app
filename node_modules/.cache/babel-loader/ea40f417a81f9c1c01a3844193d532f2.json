{"ast":null,"code":"import { isEmptyObject, mapValues, toServerDuration } from '@datadog/browser-core';\nimport { RumEventType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackViews } from './trackViews';\nexport function startViewCollection(lifeCycle, configuration, location, domMutationObservable, foregroundContexts, initialViewName) {\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, function (view) {\n    return lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processViewUpdate(view, foregroundContexts));\n  });\n  var shouldTrackViewsAutomatically = !configuration.isEnabled('view-renaming') || !configuration.trackViewsManually;\n  return trackViews(location, lifeCycle, domMutationObservable, shouldTrackViewsAutomatically, initialViewName);\n}\nfunction processViewUpdate(view, foregroundContexts) {\n  var viewEvent = {\n    _dd: {\n      document_version: view.documentVersion\n    },\n    date: view.startClocks.timeStamp,\n    type: RumEventType.VIEW,\n    view: {\n      action: {\n        count: view.eventCounts.userActionCount\n      },\n      cumulative_layout_shift: view.cumulativeLayoutShift,\n      dom_complete: toServerDuration(view.timings.domComplete),\n      dom_content_loaded: toServerDuration(view.timings.domContentLoaded),\n      dom_interactive: toServerDuration(view.timings.domInteractive),\n      error: {\n        count: view.eventCounts.errorCount\n      },\n      first_contentful_paint: toServerDuration(view.timings.firstContentfulPaint),\n      first_input_delay: toServerDuration(view.timings.firstInputDelay),\n      first_input_time: toServerDuration(view.timings.firstInputTime),\n      is_active: view.isActive,\n      name: view.name,\n      largest_contentful_paint: toServerDuration(view.timings.largestContentfulPaint),\n      load_event: toServerDuration(view.timings.loadEvent),\n      loading_time: toServerDuration(view.loadingTime),\n      loading_type: view.loadingType,\n      long_task: {\n        count: view.eventCounts.longTaskCount\n      },\n      resource: {\n        count: view.eventCounts.resourceCount\n      },\n      time_spent: toServerDuration(view.duration),\n      in_foreground_periods: foregroundContexts.getInForegroundPeriods(view.startClocks.relative, view.duration)\n    },\n    session: {\n      has_replay: view.hasReplay || undefined\n    }\n  };\n  if (!isEmptyObject(view.customTimings)) {\n    viewEvent.view.custom_timings = mapValues(view.customTimings, toServerDuration);\n  }\n  return {\n    rawRumEvent: viewEvent,\n    startTime: view.startClocks.relative,\n    domainContext: {\n      location: view.location\n    }\n  };\n}","map":{"version":3,"names":["isEmptyObject","mapValues","toServerDuration","RumEventType","LifeCycleEventType","trackViews","startViewCollection","lifeCycle","configuration","location","domMutationObservable","foregroundContexts","initialViewName","subscribe","VIEW_UPDATED","view","notify","RAW_RUM_EVENT_COLLECTED","processViewUpdate","shouldTrackViewsAutomatically","isEnabled","trackViewsManually","viewEvent","_dd","document_version","documentVersion","date","startClocks","timeStamp","type","VIEW","action","count","eventCounts","userActionCount","cumulative_layout_shift","cumulativeLayoutShift","dom_complete","timings","domComplete","dom_content_loaded","domContentLoaded","dom_interactive","domInteractive","error","errorCount","first_contentful_paint","firstContentfulPaint","first_input_delay","firstInputDelay","first_input_time","firstInputTime","is_active","isActive","name","largest_contentful_paint","largestContentfulPaint","load_event","loadEvent","loading_time","loadingTime","loading_type","loadingType","long_task","longTaskCount","resource","resourceCount","time_spent","duration","in_foreground_periods","getInForegroundPeriods","relative","session","has_replay","hasReplay","undefined","customTimings","custom_timings","rawRumEvent","startTime","domainContext"],"sources":["../../../../src/domain/rumEventsCollection/view/viewCollection.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}